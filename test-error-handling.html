<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling Test</title>
    <link rel="stylesheet" href="static/css/error-handling.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .test-section h3 {
            margin-top: 0;
            color: #1f2937;
        }

        .test-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #f9fafb;
            color: #374151;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .test-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .test-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .test-btn.primary:hover {
            background: #2563eb;
            border-color: #2563eb;
        }

        .test-btn.danger {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .test-btn.danger:hover {
            background: #dc2626;
            border-color: #dc2626;
        }

        .error-container {
            margin-top: 16px;
            min-height: 20px;
        }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-area:hover {
            border-color: #9ca3af;
            background: #f9fafb;
        }

        .upload-area.drag-over {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.05) !important;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>Error Handling Components Test</h1>
        <p>Test the comprehensive error handling system with various scenarios.</p>

        <!-- Notification System Test -->
        <div class="test-section">
            <h3>Notification System</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="testSuccess()">Success</button>
                <button class="test-btn danger" onclick="testError()">Error</button>
                <button class="test-btn" onclick="testWarning()">Warning</button>
                <button class="test-btn" onclick="testInfo()">Info</button>
                <button class="test-btn" onclick="testLoading()">Loading</button>
                <button class="test-btn" onclick="clearNotifications()">Clear All</button>
            </div>
        </div>

        <!-- Error Message Component Test -->
        <div class="test-section">
            <h3>Error Message Component</h3>
            <div class="test-buttons">
                <button class="test-btn danger" onclick="testInlineError()">Show Inline Error</button>
                <button class="test-btn" onclick="testValidationError()">Validation Error</button>
                <button class="test-btn" onclick="testNetworkError()">Network Error</button>
                <button class="test-btn" onclick="clearInlineErrors()">Clear Errors</button>
            </div>
            <div class="error-container" id="errorContainer"></div>
        </div>

        <!-- Loading State Test -->
        <div class="test-section">
            <h3>Loading States</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSpinner()">Spinner</button>
                <button class="test-btn" onclick="testDots()">Dots</button>
                <button class="test-btn" onclick="testProgress()">Progress</button>
                <button class="test-btn" onclick="testOverlay()">Overlay</button>
                <button class="test-btn" onclick="hideLoading()">Hide Loading</button>
            </div>
            <div id="loadingContainer"></div>
        </div>

        <!-- File Upload Test -->
        <div class="test-section">
            <h3>File Upload Error Handling</h3>
            <div class="upload-area" data-upload-area onclick="document.getElementById('fileInput').click()">
                <p>Drop files here or click to browse</p>
                <p><small>Try uploading non-PDF files or large files to test validation</small></p>
            </div>
            <input type="file" id="fileInput" style="display: none;" multiple>
        </div>

        <!-- Form Validation Test -->
        <div class="test-section">
            <h3>Form Validation</h3>
            <form id="testForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email (required)</label>
                    <input type="email" id="email" name="email" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="age">Age (18-100)</label>
                    <input type="number" id="age" name="age" class="form-input" min="18" max="100">
                </div>
                <div class="form-group">
                    <label class="form-label" for="website">Website</label>
                    <input type="url" id="website" name="website" class="form-input">
                </div>
                <div class="test-buttons">
                    <button type="submit" class="test-btn primary">Submit (Test Validation)</button>
                </div>
                <div class="error-container"></div>
            </form>
        </div>

        <!-- Batch Error Test -->
        <div class="test-section">
            <h3>Batch Error Handling</h3>
            <div class="test-buttons">
                <button class="test-btn danger" onclick="testBatchErrors()">Multiple Errors</button>
                <button class="test-btn" onclick="testRetryMechanism()">Test Retry</button>
            </div>
        </div>
    </div>

    <!-- Components will be inserted here -->
    <notification-system position="top-right"></notification-system>
    <loading-state></loading-state>

    <script type="module">
        import { ErrorMessage } from './js/components/error-message.js';
        import { NotificationSystem } from './js/components/notification-system.js';
        import { LoadingState } from './js/components/loading-state.js';
        import { errorHandlingService } from './js/services/error-handling-service.js';
        import { errorHandlingIntegration } from './js/modules/error-handling-integration.js';
        import { ErrorHandler } from './js/utils/error-handler.js';

        // Initialize error handling
        await errorHandlingIntegration.init();

        // Make functions global for onclick handlers
        window.testSuccess = () => {
            errorHandlingService.showSuccess('Operation completed successfully!', {
                title: 'Success',
                actions: [{
                    label: 'View Details',
                    action: 'view',
                    primary: true,
                    callback: () => alert('Details viewed!')
                }]
            });
        };

        window.testError = () => {
            errorHandlingService.showError('Something went wrong. Please try again.', {
                title: 'Error',
                actions: [{
                    label: 'Retry',
                    action: 'retry',
                    primary: true,
                    callback: () => alert('Retrying...')
                }]
            });
        };

        window.testWarning = () => {
            errorHandlingService.showWarning('This action cannot be undone.', {
                title: 'Warning',
                duration: 8000
            });
        };

        window.testInfo = () => {
            errorHandlingService.showInfo('New features are available in the Pro plan.', {
                title: 'Info',
                actions: [{
                    label: 'Learn More',
                    action: 'learn',
                    callback: () => alert('Learning more...')
                }]
            });
        };

        window.testLoading = () => {
            const id = errorHandlingService.showLoadingState('Processing your request...', {
                type: 'spinner'
            });

            setTimeout(() => {
                errorHandlingService.hideLoadingState(id);
                errorHandlingService.showSuccess('Processing complete!');
            }, 3000);
        };

        window.clearNotifications = () => {
            errorHandlingService.clearAllNotifications();
        };

        window.testInlineError = () => {
            const container = document.getElementById('errorContainer');
            const error = new Error('This is a test error message with detailed information.');

            errorHandlingService.showInlineError(error, container, {
                title: 'Test Error',
                suggestions: [
                    'Check your input data',
                    'Try refreshing the page',
                    'Contact support if the problem persists'
                ],
                retryCallback: () => alert('Retrying operation...')
            });
        };

        window.testValidationError = () => {
            errorHandlingService.handleValidationError(
                ErrorHandler.createValidationError('Email format is invalid', 'email'),
                { field: 'email' }
            );
        };

        window.testNetworkError = () => {
            errorHandlingService.handleNetworkError(
                ErrorHandler.createNetworkError('Failed to connect to server'),
                { retryCallback: () => alert('Retrying network request...') }
            );
        };

        window.clearInlineErrors = () => {
            const container = document.getElementById('errorContainer');
            errorHandlingService.clearInlineErrors(container);
        };

        window.testSpinner = () => {
            const container = document.getElementById('loadingContainer');
            const loading = document.createElement('loading-state');
            container.innerHTML = '';
            container.appendChild(loading);
            loading.showSpinner('Loading data...');
        };

        window.testDots = () => {
            const container = document.getElementById('loadingContainer');
            const loading = document.createElement('loading-state');
            container.innerHTML = '';
            container.appendChild(loading);
            loading.showDots('Processing...');
        };

        window.testProgress = () => {
            const container = document.getElementById('loadingContainer');
            const loading = document.createElement('loading-state');
            container.innerHTML = '';
            container.appendChild(loading);

            let progress = 0;
            loading.showProgress(progress, 'Uploading file...');

            const interval = setInterval(() => {
                progress += 10;
                loading.updateProgress(progress);

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => loading.hide(), 1000);
                }
            }, 200);
        };

        window.testOverlay = () => {
            errorHandlingService.showLoadingState('Processing...', {
                overlay: true,
                type: 'spinner'
            });

            setTimeout(() => {
                errorHandlingService.hideLoadingState();
            }, 3000);
        };

        window.hideLoading = () => {
            const container = document.getElementById('loadingContainer');
            container.innerHTML = '';
            errorHandlingService.hideLoadingState();
        };

        window.testBatchErrors = () => {
            const errors = [
                ErrorHandler.createFileError('File too large', 'document1.pdf'),
                ErrorHandler.createValidationError('Invalid format', 'format'),
                ErrorHandler.createNetworkError('Connection timeout'),
                ErrorHandler.createFileError('Corrupted file', 'document2.pdf')
            ];

            errorHandlingService.handleBatchErrors(errors);
        };

        window.testRetryMechanism = () => {
            let attempts = 0;
            const maxAttempts = 3;

            const failingOperation = () => {
                attempts++;
                if (attempts < maxAttempts) {
                    throw new Error(`Operation failed (attempt ${attempts}/${maxAttempts})`);
                }
                return 'Success!';
            };

            errorHandlingService.handleRetry(failingOperation, {
                maxRetries: maxAttempts,
                retryDelay: 1000
            }).then(result => {
                errorHandlingService.showSuccess(result);
            }).catch(error => {
                errorHandlingService.handleError(error);
            });
        };

        console.log('Error handling test page loaded successfully');
    </script>
</body>

</html>
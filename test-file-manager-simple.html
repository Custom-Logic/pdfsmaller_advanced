<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f7fa;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #555;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>File Manager Component Test</h1>
        
        <div class="test-section">
            <h2>Component Integration Test</h2>
            <file-manager id="testFileManager"></file-manager>
            <div id="componentStatus" class="status info">Loading component...</div>
        </div>
        
        <div class="test-section">
            <h2>Mock Data Test</h2>
            <button onclick="loadMockFiles()">Load Mock Files</button>
            <button onclick="showError()">Show Error</button>
            <button onclick="clearFiles()">Clear Files</button>
            <div id="mockStatus" class="status info">Ready to test mock data</div>
        </div>
        
        <div class="test-section">
            <h2>Event Test</h2>
            <button onclick="testEvents()">Test Event Listeners</button>
            <div id="eventStatus" class="status info">Events not tested yet</div>
        </div>
        
        <div class="test-section">
            <h2>Console Output</h2>
            <p>Check the browser console for component initialization messages and event logs.</p>
        </div>
    </div>

    <script type="module">
        // Import the components
        import './js/components/base-component.js';
        import './js/components/file-manager.js';
        
        // Test variables
        let fileManager;
        
        // Wait for component to be defined and loaded
        customElements.whenDefined('file-manager').then(() => {
            fileManager = document.getElementById('testFileManager');
            
            if (fileManager) {
                document.getElementById('componentStatus').innerHTML = 
                    '<span class="success">✓ File Manager component loaded successfully</span>';
                console.log('File Manager component:', fileManager);
            } else {
                document.getElementById('componentStatus').innerHTML = 
                    '<span class="error">✗ Failed to find File Manager component</span>';
            }
        }).catch(error => {
            document.getElementById('componentStatus').innerHTML = 
                '<span class="error">✗ Error loading File Manager: ' + error.message + '</span>';
            console.error('Component loading error:', error);
        });
        
        // Test functions
        window.loadMockFiles = function() {
            if (!fileManager) {
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="error">✗ Component not loaded</span>';
                return;
            }
            
            const mockFiles = [
                {
                    id: 'file1',
                    metadata: {
                        name: 'document1.pdf',
                        size: 1024000,
                        timestamp: Date.now() - 3600000,
                        type: 'original'
                    }
                },
                {
                    id: 'file2',
                    metadata: {
                        name: 'compressed_document1.pdf',
                        size: 512000,
                        timestamp: Date.now() - 1800000,
                        type: 'processed'
                    }
                },
                {
                    id: 'file3',
                    metadata: {
                        name: 'report.pdf',
                        size: 2048000,
                        timestamp: Date.now() - 7200000,
                        type: 'original'
                    }
                }
            ];
            
            try {
                fileManager.updateFiles(mockFiles);
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="success">✓ Mock files loaded successfully (' + mockFiles.length + ' files)</span>';
                console.log('Mock files loaded:', mockFiles);
            } catch (error) {
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="error">✗ Error loading mock files: ' + error.message + '</span>';
                console.error('Mock files error:', error);
            }
        };
        
        window.showError = function() {
            if (!fileManager) return;
            
            try {
                fileManager.showError('Test error message - this is a simulated error');
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="info">Error state displayed</span>';
            } catch (error) {
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="error">✗ Error showing error: ' + error.message + '</span>';
            }
        };
        
        window.clearFiles = function() {
            if (!fileManager) return;
            
            try {
                fileManager.updateFiles([]);
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="info">Files cleared</span>';
            } catch (error) {
                document.getElementById('mockStatus').innerHTML = 
                    '<span class="error">✗ Error clearing files: ' + error.message + '</span>';
            }
        };
        
        window.testEvents = function() {
            const eventStatus = document.getElementById('eventStatus');
            let eventCount = 0;
            
            // Listen for component events
            const testEvents = [
                'requestFileList',
                'fileDownloadRequested', 
                'fileDeleteRequested',
                'clearAllFilesRequested'
            ];
            
            testEvents.forEach(eventName => {
                document.addEventListener(eventName, (event) => {
                    eventCount++;
                    console.log(`Event received: ${eventName}`, event.detail);
                    eventStatus.innerHTML = 
                        `<span class="success">✓ Received ${eventCount} event(s). Latest: ${eventName}</span>`;
                });
            });
            
            eventStatus.innerHTML = '<span class="info">Event listeners attached. Try interacting with the File Manager above.</span>';
        };
        
        // Auto-run some tests
        setTimeout(() => {
            if (document.getElementById('componentStatus').textContent.includes('successfully')) {
                console.log('Auto-loading mock files for initial test...');
                loadMockFiles();
                testEvents();
            }
        }, 1000);
    </script>
</body>
</html>

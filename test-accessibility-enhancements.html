<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Uploader Accessibility Enhancements Test</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        
        .test-controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-controls button {
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f5f5f5;
            cursor: pointer;
        }
        
        .test-controls button:hover {
            background: #e5e5e5;
        }
        
        .accessibility-info {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border-left: 4px solid #007acc;
        }
        
        .accessibility-info h3 {
            margin-top: 0;
            color: #007acc;
        }
        
        .keyboard-instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        
        .screen-reader-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .high-contrast-demo {
            filter: contrast(200%) brightness(150%);
            border: 2px solid #000;
            padding: 20px;
            margin: 15px 0;
        }
        
        /* High contrast mode simulation */
        .simulate-high-contrast {
            background: #000 !important;
            color: #fff !important;
        }
        
        .simulate-high-contrast * {
            background: #000 !important;
            color: #fff !important;
            border-color: #fff !important;
        }
    </style>
</head>
<body>
    <h1>File Uploader Accessibility Enhancements Test</h1>
    <p>This page tests the accessibility enhancements for the dual-mode file uploader toggle switch.</p>

    <!-- Test Section 1: Basic Accessibility Features -->
    <div class="test-section">
        <h2>Test 1: Basic ARIA Attributes and Labels (Requirement 5.1)</h2>
        <div class="accessibility-info">
            <h3>What to Test:</h3>
            <ul>
                <li>Toggle has proper <code>role="switch"</code></li>
                <li>Toggle has descriptive <code>aria-label</code></li>
                <li>Toggle has <code>aria-checked</code> that reflects current state</li>
                <li>Toggle has <code>aria-describedby</code> pointing to description</li>
                <li>Labels have proper <code>aria-hidden</code> states</li>
            </ul>
        </div>
        
        <file-uploader id="test1" accept=".pdf" default-mode="single"></file-uploader>
        
        <div class="test-controls">
            <button onclick="inspectAriaAttributes('test1')">Inspect ARIA Attributes</button>
            <button onclick="toggleMode('test1')">Toggle Mode</button>
        </div>
        
        <div id="aria-output1" class="screen-reader-log"></div>
    </div>

    <!-- Test Section 2: Keyboard Navigation -->
    <div class="test-section">
        <h2>Test 2: Keyboard Navigation (Requirement 5.2)</h2>
        <div class="keyboard-instructions">
            <h3>Keyboard Test Instructions:</h3>
            <ul>
                <li><strong>Tab:</strong> Navigate to the toggle switch</li>
                <li><strong>Space or Enter:</strong> Activate the toggle</li>
                <li><strong>Escape:</strong> Get context help</li>
                <li><strong>Arrow Left/Right:</strong> Get mode switch instructions</li>
            </ul>
        </div>
        
        <file-uploader id="test2" accept=".pdf" default-mode="batch"></file-uploader>
        
        <div class="test-controls">
            <button onclick="focusToggle('test2')">Focus Toggle</button>
            <button onclick="simulateKeypress('test2', ' ')">Simulate Space</button>
            <button onclick="simulateKeypress('test2', 'Enter')">Simulate Enter</button>
            <button onclick="simulateKeypress('test2', 'Escape')">Simulate Escape</button>
        </div>
    </div>

    <!-- Test Section 3: Screen Reader Announcements -->
    <div class="test-section">
        <h2>Test 3: Screen Reader Announcements (Requirement 5.3)</h2>
        <div class="accessibility-info">
            <h3>What to Test:</h3>
            <ul>
                <li>Mode changes are announced with context</li>
                <li>File adaptation is announced when switching modes</li>
                <li>Toggle state changes are announced</li>
                <li>Error states are announced</li>
            </ul>
        </div>
        
        <file-uploader id="test3" accept=".pdf" default-mode="single"></file-uploader>
        
        <div class="test-controls">
            <button onclick="addTestFiles('test3')">Add Test Files</button>
            <button onclick="toggleModeWithFiles('test3')">Toggle Mode (with files)</button>
            <button onclick="clearAnnouncements()">Clear Log</button>
        </div>
        
        <div id="announcements-log" class="screen-reader-log">
            <strong>Screen Reader Announcements:</strong><br>
        </div>
    </div>

    <!-- Test Section 4: High Contrast Mode -->
    <div class="test-section">
        <h2>Test 4: High Contrast Mode Visibility (Requirement 5.4)</h2>
        <div class="accessibility-info">
            <h3>What to Test:</h3>
            <ul>
                <li>Toggle remains visible in high contrast mode</li>
                <li>Focus indicators are clearly visible</li>
                <li>Active states are distinguishable</li>
                <li>Disabled states are clearly indicated</li>
            </ul>
        </div>
        
        <div class="high-contrast-demo" id="high-contrast-demo">
            <file-uploader id="test4" accept=".pdf" default-mode="single"></file-uploader>
        </div>
        
        <div class="test-controls">
            <button onclick="toggleHighContrast()">Toggle High Contrast Simulation</button>
            <button onclick="focusToggle('test4')">Focus Toggle</button>
            <button onclick="toggleMode('test4')">Toggle Mode</button>
        </div>
    </div>

    <!-- Test Section 5: Disabled State Handling -->
    <div class="test-section">
        <h2>Test 5: Disabled State Handling (Requirement 5.5)</h2>
        <div class="accessibility-info">
            <h3>What to Test:</h3>
            <ul>
                <li>Toggle becomes non-interactive when disabled</li>
                <li>Focus is properly managed when disabled</li>
                <li>ARIA attributes reflect disabled state</li>
                <li>Visual indicators show disabled state</li>
            </ul>
        </div>
        
        <file-uploader id="test5" accept=".pdf" default-mode="single"></file-uploader>
        
        <div class="test-controls">
            <button onclick="toggleDisabled('test5')">Toggle Component Disabled</button>
            <button onclick="toggleToggleDisabled('test5')">Toggle Switch Disabled</button>
            <button onclick="focusToggle('test5')">Try to Focus Toggle</button>
            <button onclick="inspectDisabledState('test5')">Inspect Disabled State</button>
        </div>
        
        <div id="disabled-output" class="screen-reader-log"></div>
    </div>

    <!-- Import the FileUploader component -->
    <script type="module">
        import { FileUploader } from './js/components/file-uploader.js';
        
        // Register the custom element
        if (!customElements.get('file-uploader')) {
            customElements.define('file-uploader', FileUploader);
        }

        // Global test functions
        window.inspectAriaAttributes = function(id) {
            const uploader = document.getElementById(id);
            const toggle = uploader.shadowRoot.querySelector('.toggle-switch');
            const output = document.getElementById('aria-output1');
            
            if (toggle) {
                const attributes = {
                    'role': toggle.getAttribute('role'),
                    'aria-checked': toggle.getAttribute('aria-checked'),
                    'aria-label': toggle.getAttribute('aria-label'),
                    'aria-describedby': toggle.getAttribute('aria-describedby'),
                    'aria-disabled': toggle.getAttribute('aria-disabled'),
                    'tabindex': toggle.getAttribute('tabindex')
                };
                
                output.innerHTML = '<strong>ARIA Attributes:</strong><br>' + 
                    Object.entries(attributes)
                        .map(([key, value]) => `${key}: ${value || 'not set'}`)
                        .join('<br>');
            }
        };

        window.toggleMode = function(id) {
            const uploader = document.getElementById(id);
            const currentMode = uploader.getMode();
            const newMode = currentMode === 'single' ? 'batch' : 'single';
            uploader.setMode(newMode);
        };

        window.focusToggle = function(id) {
            const uploader = document.getElementById(id);
            const toggle = uploader.shadowRoot.querySelector('.toggle-switch');
            if (toggle) {
                toggle.focus();
            }
        };

        window.simulateKeypress = function(id, key) {
            const uploader = document.getElementById(id);
            const toggle = uploader.shadowRoot.querySelector('.toggle-switch');
            if (toggle) {
                const event = new KeyboardEvent('keydown', { key: key });
                toggle.dispatchEvent(event);
            }
        };

        window.addTestFiles = function(id) {
            const uploader = document.getElementById(id);
            // Simulate adding files
            const mockFiles = [
                new File(['test content 1'], 'test1.pdf', { type: 'application/pdf' }),
                new File(['test content 2'], 'test2.pdf', { type: 'application/pdf' })
            ];
            
            // Trigger file processing
            uploader.processFiles(mockFiles, 'selection');
        };

        window.toggleModeWithFiles = function(id) {
            // First add files, then toggle mode
            addTestFiles(id);
            setTimeout(() => toggleMode(id), 100);
        };

        window.clearAnnouncements = function() {
            const log = document.getElementById('announcements-log');
            log.innerHTML = '<strong>Screen Reader Announcements:</strong><br>';
        };

        window.toggleHighContrast = function() {
            const demo = document.getElementById('high-contrast-demo');
            demo.classList.toggle('simulate-high-contrast');
        };

        window.toggleDisabled = function(id) {
            const uploader = document.getElementById(id);
            if (uploader.hasAttribute('disabled')) {
                uploader.removeAttribute('disabled');
            } else {
                uploader.setAttribute('disabled', '');
            }
        };

        window.toggleToggleDisabled = function(id) {
            const uploader = document.getElementById(id);
            if (uploader.hasAttribute('toggle-disabled')) {
                uploader.removeAttribute('toggle-disabled');
            } else {
                uploader.setAttribute('toggle-disabled', '');
            }
        };

        window.inspectDisabledState = function(id) {
            const uploader = document.getElementById(id);
            const toggle = uploader.shadowRoot.querySelector('.toggle-switch');
            const output = document.getElementById('disabled-output');
            
            if (toggle) {
                const state = {
                    'Component disabled': uploader.hasAttribute('disabled'),
                    'Toggle disabled': uploader.hasAttribute('toggle-disabled'),
                    'Toggle aria-disabled': toggle.getAttribute('aria-disabled'),
                    'Toggle tabindex': toggle.getAttribute('tabindex'),
                    'Toggle disabled attribute': toggle.hasAttribute('disabled')
                };
                
                output.innerHTML = '<strong>Disabled State:</strong><br>' + 
                    Object.entries(state)
                        .map(([key, value]) => `${key}: ${value}`)
                        .join('<br>');
            }
        };

        // Monitor screen reader announcements
        const originalAnnounce = FileUploader.prototype.announceToScreenReader;
        FileUploader.prototype.announceToScreenReader = function(message) {
            // Call original method
            originalAnnounce.call(this, message);
            
            // Log to our test interface
            const log = document.getElementById('announcements-log');
            if (log) {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `[${timestamp}] ${message}<br>`;
                log.scrollTop = log.scrollHeight;
            }
        };

        // Add event listeners for mode changes
        document.addEventListener('mode-changed', function(event) {
            console.log('Mode changed event:', event.detail);
            const log = document.getElementById('announcements-log');
            if (log) {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `[${timestamp}] EVENT: Mode changed to ${event.detail.newMode}<br>`;
                log.scrollTop = log.scrollHeight;
            }
        });
    </script>
</body>
</html>